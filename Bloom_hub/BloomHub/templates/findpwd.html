{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>비밀번호 찾기</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <h1>비밀번호 찾기</h1>
    <form id="find-password-form">
        <label for="user_id">ID:</label>
        <input type="text" id="user_id" name="user_id" required>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <button type="button" id="send-code-btn">인증번호 보내기</button>

        <div id="verification-section" style="display: none;">
            <label for="verification-code">인증번호:</label>
            <input type="text" id="verification-code" required>
            <button type="button" id="verify-code-btn">확인</button>
        </div>

        <div id="reset-password-section" style="display: none;">
            <label for="new-password">New Password:</label>
            <input type="password" id="new-password" required>
            <label for="confirm-password">Confirm Password:</label>
            <input type="password" id="confirm-password" required>
            <button type="button" id="reset-password-btn">변경</button>
        </div>
    </form>
    <div id="message"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#send-code-btn').click(function() {
                $.post({
                    url: "{% url 'send_verification_code_for_password_reset' %}",
                    data: { user_id: $('#user_id').val(), email: $('#email').val(), csrfmiddlewaretoken: '{{ csrf_token }}' },
                    success: function(response) {
                        if (response.success) {
                            $('#verification-section').show();
                            alert(response.message);
                        } else {
                            alert(response.message);
                        }
                    }
                });
            });

            $('#verify-code-btn').click(function() {
                $.post({
                    url: "{% url 'verify_code_for_password_reset' %}",
                    data: { user_id: $('#user_id').val(), email: $('#email').val(), verification_code: $('#verification-code').val(), csrfmiddlewaretoken: '{{ csrf_token }}' },
                    success: function(response) {
                        if (response.success) {
                            $('#verification-section').hide();
                            $('#reset-password-section').show();
                        } else {
                            alert(response.message);
                        }
                    }
                });
            });

            $('#reset-password-btn').click(function() {
                $.post({
                    url: "{% url 'reset_password' %}",
                    data: { user_id: $('#user_id').val(), new_password: $('#new-password').val(), confirm_password: $('#confirm-password').val(), csrfmiddlewaretoken: '{{ csrf_token }}' },
                    success: function(response) {
                        if (response.success) {
                            alert("비밀번호가 업데이트되었습니다.");
                            window.location.href = "{% url 'home' %}";
                        } else {
                            alert(response.message);
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
