<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>학습중인 영상</title>
    <link rel="stylesheet" href="learning.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>


    



    <header>
        <a href="index.html" class="logo">
            <span>Blo0m </span>
            <span>Youtube</span>
            <span>Studies</span>
        </a>
        <nav>
            <a href="guide.html">Guides</a>
            <a href="search.html">Search</a>
            <a href="mypage.html">My profile</a>
            <div class="dropdown-container">
                <a href="#" class="classing">Classing</a>
                <div class="dropdown">
                    <a href="learning.html">Learning Video</a>
                    <a href="learned.html">Learned Video</a>
                </div>
            </div>
        </nav>
        <div class="auth">
            <div class="language-container">
                <a href="#" class="language">Language</a>
                <div class="language-dropdown">
                    <a href="index한국어.html">Korean</a>
                    <a href="#">English</a>
                </div>
            </div>
            <a href="로그인.html" id="login-link">Login</a>
            <a href="회원가입.html" id="signup-link">Sign up</a>
            <a href="#" id="logout-link" style="display: none;">Logout</a>
        </div>
    </header>
    <hr>

    <main>
        <div class="h1-container">
            <h1>학습중인 영상</h1>
        </div>
        <table>
            <thead>
                <tr>
                    <th>썸네일</th>
                    <th>영상제목</th>
                    <th>영상길이</th>
                    <th>채널명</th>
                    <th>조회수</th>
                    <th>학습하기</th>
                </tr>
                
            </thead>
            <tbody id="learning-results">
                <iframe id="player" type="text/html" width="640" height="360"
                src="http://www.youtube.com/embed/M7lc1UVf-VE?enablejsapi=1&origin=http://example.com"
                frameborder="0"></iframe>



                <!-- 학습중인 영상 목록 -->
            </tbody>
        </table>
    </main>

    <script>
        $(document).ready(function () {
            // 시청 기록 불러오기
            $.get('/get-watched-videos', function (data) {
                if (data.success) {
                    const container = $('#learning-results'); // 시청 기록을 추가할 위치
                    data.watchedVideos.forEach(video => {
                        const videoElement = 
                        
                        
                        
                         /*  `
                            <div class="video-item">
                                <h3>${video.title}</h3>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/${video.videoId}" frameborder="0" allowfullscreen></iframe>
                                <p>시청 날짜: ${new Date(video.watchedDate).toLocaleString()}</p>
                            </div>
                        `; */
                
                        
                        `
                            <tr>
                                <td><img src="https://img.youtube.com/vi/${video.videoId}/hqdefault.jpg" alt="썸네일" width="120"></td>
                                <td>${video.title}</td>
                                <td>${video.duration}</td>
                                <td>${video.channel}</td>
                                <td>${video.views}</td>
                                <td><button onclick="saveWatchedVideo('${video.videoId}', '${video.title}')">학습하기</button></td>
                            </tr>
                        `;
                        container.append(videoElement);
                    });
                } else {
                    alert('시청 기록을 불러오는 중 문제가 발생했습니다.');
                }
            });

            // 로그인 상태 확인
            $.get('/check-login', function (data) {
                if (data.loggedIn) {
                    $('#login-link').hide();
                    $('#signup-link').hide();
                    $('#logout-link').show();
                } else {
                    $('#login-link').show();
                    $('#signup-link').show();
                    $('#logout-link').hide();
                }
            });

            // 로그아웃 처리
            $('#logout-link').on('click', function (e) {
                e.preventDefault();
                $.get('/logout', function (data) {
                    if (data.success) {
                        alert('로그아웃 되었습니다.');
                        location.reload();
                    }
                });
            });
        });






        // 유튜브 영상을 시청할 때마다 해당 영상을 시청 기록에 저장
        function saveWatchedVideo(videoId, title) {
            $.post('/save-watched-video', { videoId, title }, function (data) {
                if (!data.success) {
                    alert('시청 기록 저장 중 문제가 발생했습니다.');
                }
            });
        }

        // 추천 영상 가져오기
        document.addEventListener('DOMContentLoaded', function () {
            fetch('analysis.json')
                .then(response => response.json())
                .then(data => {
                    const recommendedResultsContainer = document.getElementById('recommended-results');
                    recommendedResultsContainer.innerHTML = '';

                    data.recommendations.forEach(result => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><img src="${result.thumbnail}" alt="썸네일" width="120"></td>
                            <td>${result.title}</td>
                            <td>${result.duration}</td>
                            <td>${result.channel}</td>
                            <td>${result.views}</td>
                            <td><button class="learn-btn">클릭</button></td>
                        `;
                        recommendedResultsContainer.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching recommendations:', error));
        });
    </script>

    <div class="recommender-section">
        <div class="recommender-h1-container">
            <h1>추천 영상</h1>
        </div>
        <table>
            <thead>
                <tr>
                    <th>썸네일</th>
                    <th>영상제목</th>
                    <th>영상길이</th>
                    <th>채널명</th>
                    <th>조회수</th>
                    <th>학습하기</th>
                </tr>
            </thead>
            <tbody id="recommended-results">
                <!-- 추천 영상 목록 -->
            </tbody>
        </table>
    </div>

</body>

</html>
