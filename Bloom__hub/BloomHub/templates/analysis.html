{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>분석 페이지</title>
    <link rel="stylesheet" href="{% static 'css/analysis.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <header>
        <a href="{% url 'home' %}" class="logo">
            <img src="{% static 'img/logo.png' %}" alt="logo" style="height: 100px;">
        </a>
        
        <nav>
            <a href="{% url 'guide' %}">Guides</a>
            <a href="{% url 'search' %}">Search</a>
            <a href="{% url 'mypage' %}">My profile</a>
            <div class="dropdown-container">
                <a href="#" class="classing">Classing</a>
                <div class="dropdown">
                    <a href="{% url 'learning' %}">Learning Video</a>
                    <a href="{% url 'learned' %}">Learned Video</a>
                </div>
            </div>
        </nav>
        <div class="auth">
            <div class="language-container">
                <a href="#" class="language">Language</a>
                <div class="language-dropdown">
                    <a href="{% url 'guidekor' %}">Korean</a>
                    <a href="{% url 'guide' %}">English</a>
                </div>
            </div>
            <a href="{% url 'login' %}" id="login-link">Login</a>
            <a href="{% url 'signup' %}" id="signup-link">Sign up</a>
            <a href="#" id="logout-link" style="display: none;">Logout</a>
        </div>
    </header>

    <main>
        <div class="video-container">
            <div class="video-thumbnail" id="video-thumbnail">
                <img src="thumbnail.png" alt="유튜브 영상 썸네일" id="youtube-thumbnail">
            </div>
            <div class="video-controls" id="controls">
                <div class="language-select">
                    <span>영상 지원 언어 선택</span>
                    <a href="#">한국어</a>
                    <a href="#">영어</a>
                </div>
                <button class="btn btn-save" onclick="saveVideo()">학습할 영상에 저장</button>
                <button class="btn btn-analyze" onclick="goToAnalysis()">분석하기</button>
            </div>
            <div class="keyword-section">
                <h2>키워드</h2>
                <div class="keywords" id="keywords">
                    <!-- 키워드 추가 -->
                </div>
                <div class="pyramid" id="pyramid" style="display: none;">
                    <div class="level level-6">Evaluate</div>
                    <div class="level level-5">Analyze</div>
                    <div class="level level-4">Apply</div>
                    <div class="level level-3">Understand</div>
                    <div class="level level-2">Remember</div>
                </div>
            </div>
        </div>

        <div class="popup" id="popup">
            자막이 없습니다.
            <button onclick="hidePopup()">닫기</button>
        </div>

        <div class="video-info">
            <p>제목 | 조회수</p>
            <p>채널명</p>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const videoId = 'SITE_VIDEO_ID';
            const youtubeVideoId = 'YOUTUBE_VIDEO_ID';
            const videoThumbnail = document.getElementById('youtube-thumbnail');
            videoThumbnail.src = `https://img.youtube.com/vi/${youtubeVideoId}/hqdefault.jpg`;

            window.saveVideo = async function() {
                const video = {
                    videoId: videoId,
                    youtubeVideoId: youtubeVideoId,
                    title: '영상 제목',
                    channel: '채널명'
                };

                try {
                    const response = await fetch('/api/learning-videos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(video)
                    });

                    if (response.ok) {
                        alert('영상이 학습 중인 목록에 저장되었습니다.');
                        window.location.href = 'learning.html';
                    } else {
                        alert('영상 저장 실패');
                    }
                } catch (error) {
                    console.error('영상 저장 중 오류 발생:', error);
                }
            };

            window.goToAnalysis = async function() {
                const video = {
                    videoId: videoId,
                    youtubeVideoId: youtubeVideoId,
                    title: '영상 제목',
                    channel: '채널명'
                };

                try {
                    const response = await fetch('/api/completed-videos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(video)
                    });

                    if (response.ok) {
                        alert('영상이 학습 완료되었습니다.');
                        displayAnalysis();
                    } else {
                        alert('학습 완료 처리 실패');
                    }
                } catch (error) {
                    console.error('학습 완료 처리 중 오류 발생:', error);
                }
            };

            function displayAnalysis() {
                const keywordsContainer = document.getElementById('keywords');
                keywordsContainer.innerHTML = '';
                const keywords = ['#파이썬', '#코딩', '#데이터', '#웹', '#처음'];
                keywords.forEach(keyword => {
                    const keywordDiv = document.createElement('div');
                    keywordDiv.classList.add('keyword');
                    keywordDiv.textContent = keyword;
                    keywordsContainer.appendChild(keywordDiv);
                });

                const pyramid = document.getElementById('pyramid');
                pyramid.style.display = 'block';
            }

            window.hidePopup = function() {
                document.querySelector('.popup').style.display = 'none';
            };
        });
    </script>

</body>

</html>
